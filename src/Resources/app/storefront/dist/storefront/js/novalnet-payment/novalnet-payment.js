(()=>{"use strict";let e="loader",t={BEFORE:"before",INNER:"inner"};class n{constructor(e,n=t.BEFORE){this.parent=e instanceof Element?e:document.body.querySelector(e),this.position=n}create(){if(!this.exists()){if(this.position===t.INNER){this._previousHTML=this.parent.innerHTML,this.parent.innerHTML=n.getTemplate();return}this.parent.insertAdjacentHTML(this._getPosition(),n.getTemplate())}}remove(){if(this.position===t.INNER){this.parent.innerHTML=this._previousHTML;return}this.parent.querySelectorAll(`.${e}`).forEach(e=>e.remove())}exists(){return this.parent.querySelectorAll(`.${e}`).length>0}_getPosition(){return this.position===t.BEFORE?"afterbegin":"beforeend"}static getTemplate(){return`<div class="${e}" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>`}static SELECTOR_CLASS(){return e}}class i{static isTouchDevice(){return"ontouchstart"in document.documentElement}static isIOSDevice(){return i.isIPhoneDevice()||i.isIPadDevice()}static isNativeWindowsBrowser(){return i.isIEBrowser()||i.isEdgeBrowser()}static isIPhoneDevice(){return!!navigator.userAgent.match(/iPhone/i)}static isIPadDevice(){return!!navigator.userAgent.match(/iPad/i)}static isIEBrowser(){return -1!==navigator.userAgent.toLowerCase().indexOf("msie")||!!navigator.userAgent.match(/Trident.*rv:\d+\./)}static isEdgeBrowser(){return!!navigator.userAgent.match(/Edge\/\d+/i)}static getList(){return{"is-touch":i.isTouchDevice(),"is-ios":i.isIOSDevice(),"is-native-windows":i.isNativeWindowsBrowser(),"is-iphone":i.isIPhoneDevice(),"is-ipad":i.isIPadDevice(),"is-ie":i.isIEBrowser(),"is-edge":i.isEdgeBrowser()}}}let r="modal-backdrop",o="modal-backdrop-open",s="no-scroll",a={ON_CLICK:"backdrop/onclick"};class l{constructor(){return l.instance||(l.instance=this),l.instance}create(e){this._removeExistingBackdrops(),document.body.insertAdjacentHTML("beforeend",this._getTemplate());let t=document.body.lastChild;document.documentElement.classList.add(s),setTimeout(function(){t.classList.add(o),"function"==typeof e&&e()},75),this._dispatchEvents()}remove(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:350;this._getBackdrops().forEach(e=>e.classList.remove(o)),setTimeout(this._removeExistingBackdrops.bind(this),e),document.documentElement.classList.remove(s)}_dispatchEvents(){let e=i.isTouchDevice()?"touchstart":"click";document.addEventListener(e,function(e){e.target.classList.contains(r)&&document.dispatchEvent(new CustomEvent(a.ON_CLICK))})}_getBackdrops(){return document.querySelectorAll(`.${r}`)}_removeExistingBackdrops(){!1!==this._exists()&&this._getBackdrops().forEach(e=>e.remove())}_exists(){return document.querySelectorAll(`.${r}`).length>0}_getTemplate(){return`<div class="${r}"></div>`}}let c=Object.freeze(new l);class u{static create(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;c.create(e)}static remove(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:350;c.remove(e)}static SELECTOR_CLASS(){return r}}let d=Object.freeze(new class extends n{constructor(){super(document.body)}create(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];!this.exists()&&e&&(u.create(),document.querySelector(`.${u.SELECTOR_CLASS()}`).insertAdjacentHTML("beforeend",n.getTemplate()))}remove(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];super.remove(),e&&u.remove()}});class m{static create(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];d.create(e)}static remove(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];d.remove(e)}}class h{static isSupported(){return"undefined"!==document.cookie}static setItem(e,t,n){if(null==e)throw Error("You must specify a key to set a cookie");let i=new Date;i.setTime(i.getTime()+864e5*n);let r="";"https:"===location.protocol&&(r="secure"),document.cookie=`${e}=${t};expires=${i.toUTCString()};path=/;sameSite=lax;${r}`}static getItem(e){if(!e)return!1;let t=e+"=",n=document.cookie.split(";");for(let e=0;e<n.length;e++){let i=n[e];for(;" "===i.charAt(0);)i=i.substring(1);if(0===i.indexOf(t))return i.substring(t.length,i.length)}return!1}static removeItem(e){document.cookie=`${e}= ; expires = Thu, 01 Jan 1970 00:00:00 GMT;path=/`}static key(){return""}static clear(){}}class p extends n{constructor(e,t="before"){super(e,t),this._isValidElement()||console.warn(`[ButtonLoadingIndicatorUtil] Parent element is not of type <button> or <a>. Given element: ${this.parent}`)}create(){if(!this._isValidElement()){console.warn(`[ButtonLoadingIndicatorUtil] Unable to create loading indicator. Parent element is not of type <button> or <a>. Given element: ${this.parent}`);return}if("inner"===this.position){let e=this.parent.getBoundingClientRect().width;this.parent.style.width=`${e}px`}super.create(),this.parent.classList.add(`is-loading-indicator-${this.position}`),this._isButtonElement()?this.parent.disabled=!0:this._isAnchorElement()&&this.parent.classList.add("disabled")}remove(){if(!this.exists()){console.warn(`[ButtonLoadingIndicatorUtil] Unable to remove loading indicator. No indicator present on given element: ${this.parent}`);return}"inner"===this.position&&(this.parent.style.width="auto"),super.remove(),this.parent.classList.remove(`is-loading-indicator-${this.position}`),this._isButtonElement()?this.parent.disabled=!1:this._isAnchorElement()&&this.parent.classList.remove("disabled")}_isValidElement(){return this._isButtonElement()||this._isAnchorElement()}_isButtonElement(){return this.parent?.tagName.toLowerCase()==="button"}_isAnchorElement(){return this.parent?.tagName.toLowerCase()==="a"}}class v{static serialize(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if("FORM"!==e.nodeName){if(t)throw Error("The passed element is not a form!");return{}}return new FormData(e)}static serializeJson(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=v.serialize(e,t);if(!(n instanceof FormData)&&0===Object.keys(n).length||n instanceof FormData&&0===Array.from(n.entries()).length)return{};let i={};for(let[e,t]of n.entries())i[e]=t;return i}}let{PluginBaseClass:y,PluginManager:g}=window;window.PluginManager.register("NovalnetPayment",class extends y{init(){this._createScript(function(){let e=JSON.parse(this.el.dataset.lineitems),t=new NovalnetPaymentForm,n=document.querySelector("#novalnetId"),i=document.querySelectorAll('#confirmOrderForm button[type="submit"]'),r=document.querySelector('#novalnetchangePaymentForm button[type="submit"]'),o=this,s=document.querySelectorAll('input[name="paymentMethodId"]'),a="novalnetPaymentCookie";if(t.addSkeleton("#novalnetPaymentIframe"),null!=n){(void 0===document.querySelector("input[name=paymentMethodId]:checked")||null===document.querySelector("input[name=paymentMethodId]:checked"))&&(document.querySelector("#paymentMethod"+n.value).checked=!0,o.sendFormPostData());let l=document.querySelector("input[name=paymentMethodId]:checked"),c={iframe:"#novalnetPaymentIframe",initForm:{orderInformation:{lineItems:e},showButton:!1,uncheckPayments:!0}};n.value===l.value&&(c.initForm.uncheckPayments=!1,o.disableSubmitButton(!0)),!1!=h.getItem(a)&&void 0!=h.getItem(a)&&n.value===l.value&&(c.initForm.checkPayment=h.getItem(a)),1==document.querySelectorAll('form[action$="/account/payment"]').length&&(c.initForm.styleText={forceStyling:{text:".payment-type-container > .payment-type > .payment-form{display: none !important;}"}}),t.initiate(c),t.validationResponse(e=>{if(t.initiate(c),"340"==e.result.statusCode&&"NO_PAYMENT_METHODS"==e.result.nnpf_subType&&n.value===l.value){o.displayErrorMsg(document.getElementById("iframeErrorMessage").value,"info");return}o.disableSubmitButton(!1)}),s.forEach(function(e){"hidden"!==e.getAttribute("type")&&(e.addEventListener("click",e=>{e.target.value!==n.value&&t.uncheckPayment()}),!0===e.checked&&e.value!==n.value&&t.uncheckPayment())}),t.selectedPayment(function(e){h.setItem(a,e.payment_details.type);let t=document.querySelector("#isSubscriptionRestrict");"GOOGLEPAY"==e.payment_details.type||"APPLEPAY"==e.payment_details.type?o.hideSubmitButton("none"):(null==t||0===t.value)&&o.hideSubmitButton("inline-block"),n.value!==l.value&&(document.querySelector("#paymentMethod"+n.value).checked=!0,null==r&&o.sendFormPostData(!0))}),t.walletResponse({onProcessCompletion:function(e){if("SUCCESS"==e.result.status)return void 0!==document.querySelector("#isSubscriptionRestrict")&&null!==document.querySelector("#isSubscriptionRestrict")&&1==document.querySelector("#isSubscriptionRestrict").value?(window.scrollTo(0,0),{status:"FAILURE",statusText:"failure"}):null!=r?o.subscriptionFetchData(e):(document.querySelector("#novalnet-paymentdata").value=JSON.stringify(e),document.querySelector("#confirmOrderForm").submit(),{status:"SUCCESS",statusText:"successfull"})},onPaymentButtonClicked:function(){return void 0!==document.querySelector("#isSubscriptionRestrict")&&null!==document.querySelector("#isSubscriptionRestrict")&&1==document.querySelector("#isSubscriptionRestrict").value?(window.scrollTo(0,0),"FAILURE"):"SUCCESS"}}),null!=i&&i.forEach(function(e){e.addEventListener("click",e=>{if(n.value===l.value){if(null!==document.querySelector("#tos")&&!0!==document.querySelector("#tos").checked||null!==document.querySelector("#revocation")&&!0!==document.querySelector("#revocation").checked)return!1;let n=document.querySelector("#isSubscriptionRestrict");if(null!=n&&1===n.value)return window.scrollTo(0,0),!1;o.handleFormSubmit(e,t)}})}),void 0!=r&&null!=r&&r.addEventListener("click",e=>{let i=document.querySelector("input[name=paymentMethodId]:checked");n.value===i.value&&o.handleFormSubmit(e,t,!0)})}})}handleFormSubmit(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this;this.disableSubmitButton(!0,!0),e.preventDefault(),e.stopImmediatePropagation(),t.getPayment(function(e){"100"===e.result.statusCode||"SUCCESS"===e.result.status?n?i.subscriptionFetchData(e):(document.querySelector("#novalnet-paymentdata").value=JSON.stringify(e),document.querySelector("#confirmOrderForm").submit()):(document.querySelector("#novalnet-paymentdata").value="",i.displayErrorMsg(e.result.message,"danger",n),i.disableSubmitButton(!1,!0))})}async subscriptionFetchData(e){let t=document.querySelector("#novalnetId");return void 0!==document.getElementById("parentOrderNumber")&&(e.parentOrderNumber=document.getElementById("parentOrderNumber").value,e.aboId=document.getElementById("aboId").value,e.paymentMethodId=t.value),await fetch(document.getElementById("storeCustomerDataUrl").value,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).then(e=>!0==e.success&&void 0!=e.redirect_url?(window.location.replace(e.redirect_url),{status:"SUCCESS",statusText:"successfull"}):!0==e.success?(document.querySelector("#novalnetchangePaymentForm").submit(),{status:"SUCCESS",statusText:"successfull"}):(this.displayErrorMsg(e.message,"danger",!0),this.disableSubmitButton(!1,!0),{status:"FAILURE",statusText:"failure"}))}disableSubmitButton(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=document.querySelectorAll('#confirmOrderForm button[type="submit"]'),i=document.querySelector('#novalnetchangePaymentForm button[type="submit"]');if(n.length>0)n.forEach(function(n){if(n.disabled=e,t){let t=new p(n);e?t.create():t.remove()}});else if(null!=i&&(i.disabled=e,t)){let t=new p(i);e?t.create():t.remove()}}hideSubmitButton(e){let t=document.querySelectorAll('#confirmOrderForm button[type="submit"]'),n=document.querySelector('#novalnetchangePaymentForm button[type="submit"]');t.length>0?t.forEach(function(t){t.style.display=e}):null!=n&&(n.style.display=e)}sendFormPostData(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=document.querySelector("input[name=paymentMethodId]:checked"),n=v.serialize(t.closest("form")),i=t.closest("form").getAttribute("action");e&&m.create(),fetch(i,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n}).then(e=>e.text()).then(t=>{g.initializePlugins(),e&&(m.remove(),document.querySelector("#novalnetId").closest("form").submit())})}_createScript(e){let t="https://cdn.novalnet.de/js/pv13/checkout.js?"+new Date().getTime(),n=document.createElement("script");n.type="text/javascript",n.src=t,n.addEventListener("load",e.bind(this),!1),document.head.appendChild(n)}displayErrorMsg(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=document.createElement("div"),r=document.createElement("div"),o=document.createElement("div"),s=document.createElement("span");if("danger"==t?i.className="alert alert-danger d-flex align-items-center":i.className="alert alert-info d-flex align-items-center",r.className="alert-content-container",o.className="alert-content",s.className="icon icon-blocked",s.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24" viewBox="0 0 24 24"><defs><path d="M12 24C5.3726 24 0 18.6274 0 12S5.3726 0 12 0s12 5.3726 12 12-5.3726 12-12 12zm0-2c5.5228 0 10-4.4772 10-10S17.5228 2 12 2 2 6.4772 2 12s4.4772 10 10 10zm4.2929-15.7071c.3905-.3905 1.0237-.3905 1.4142 0 .3905.3905.3905 1.0237 0 1.4142l-10 10c-.3905.3905-1.0237.3905-1.4142 0-.3905-.3905-.3905-1.0237 0-1.4142l10-10z" id="icons-default-blocked"></path></defs><use xlink:href="#icons-default-blocked" fill="#758CA3" fill-rule="evenodd"></use></svg>',i.appendChild(s),i.appendChild(r),r.appendChild(o),o.innerHTML=e,n){let e=document.getElementsByClassName("alert alert-danger d-flex align-items-center"),t=document.getElementById("novalnetchangePaymentForm");for(;e.length>0;)e[0].parentNode.removeChild(e[0]);t.parentNode.insertBefore(i,t),i.scrollIntoView()}else document.querySelector(".flashbags").innerHTML="",document.querySelector(".flashbags").appendChild(i),document.querySelector(".flashbags").scrollIntoView()}},"#novalnet-payment-script")})();