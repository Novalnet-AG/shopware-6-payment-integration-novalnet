(()=>{"use strict";let e="loader",t={BEFORE:"before",INNER:"inner"};class n{constructor(e,n=t.BEFORE){this.parent=e instanceof Element?e:document.body.querySelector(e),this.position=n}create(){if(!this.exists()){if(this.position===t.INNER){this._previousHTML=this.parent.innerHTML,this.parent.innerHTML=n.getTemplate();return}this.parent.insertAdjacentHTML(this._getPosition(),n.getTemplate())}}remove(){if(this.position===t.INNER){this.parent.innerHTML=this._previousHTML;return}this.parent.querySelectorAll(`.${e}`).forEach(e=>e.remove())}exists(){return this.parent.querySelectorAll(`.${e}`).length>0}_getPosition(){return this.position===t.BEFORE?"afterbegin":"beforeend"}static getTemplate(){return`<div class="${e}" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>`}static SELECTOR_CLASS(){return e}}class r{static isTouchDevice(){return"ontouchstart"in document.documentElement}static isIOSDevice(){return r.isIPhoneDevice()||r.isIPadDevice()}static isNativeWindowsBrowser(){return r.isIEBrowser()||r.isEdgeBrowser()}static isIPhoneDevice(){return!!navigator.userAgent.match(/iPhone/i)}static isIPadDevice(){return!!navigator.userAgent.match(/iPad/i)}static isIEBrowser(){return -1!==navigator.userAgent.toLowerCase().indexOf("msie")||!!navigator.userAgent.match(/Trident.*rv:\d+\./)}static isEdgeBrowser(){return!!navigator.userAgent.match(/Edge\/\d+/i)}static getList(){return{"is-touch":r.isTouchDevice(),"is-ios":r.isIOSDevice(),"is-native-windows":r.isNativeWindowsBrowser(),"is-iphone":r.isIPhoneDevice(),"is-ipad":r.isIPadDevice(),"is-ie":r.isIEBrowser(),"is-edge":r.isEdgeBrowser()}}}let s="modal-backdrop",i="modal-backdrop-open",o="no-scroll",a={ON_CLICK:"backdrop/onclick"};class l{constructor(){return l.instance||(l.instance=this),l.instance}create(e){this._removeExistingBackdrops(),document.body.insertAdjacentHTML("beforeend",this._getTemplate());let t=document.body.lastChild;document.documentElement.classList.add(o),setTimeout(function(){t.classList.add(i),"function"==typeof e&&e()},75),this._dispatchEvents()}remove(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:350;this._getBackdrops().forEach(e=>e.classList.remove(i)),setTimeout(this._removeExistingBackdrops.bind(this),e),document.documentElement.classList.remove(o)}_dispatchEvents(){let e=r.isTouchDevice()?"touchstart":"click";document.addEventListener(e,function(e){e.target.classList.contains(s)&&document.dispatchEvent(new CustomEvent(a.ON_CLICK))})}_getBackdrops(){return document.querySelectorAll(`.${s}`)}_removeExistingBackdrops(){!1!==this._exists()&&this._getBackdrops().forEach(e=>e.remove())}_exists(){return document.querySelectorAll(`.${s}`).length>0}_getTemplate(){return`<div class="${s}"></div>`}}let c=Object.freeze(new l);class u{static create(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;c.create(e)}static remove(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:350;c.remove(e)}static SELECTOR_CLASS(){return s}}let d=Object.freeze(new class extends n{constructor(){super(document.body)}create(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];!this.exists()&&e&&(u.create(),document.querySelector(`.${u.SELECTOR_CLASS()}`).insertAdjacentHTML("beforeend",n.getTemplate()))}remove(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];super.remove(),e&&u.remove()}});class m{static create(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];d.create(e)}static remove(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];d.remove(e)}}class h{static isSupported(){return"undefined"!==document.cookie}static setItem(e,t,n){if(null==e)throw Error("You must specify a key to set a cookie");let r=new Date;r.setTime(r.getTime()+864e5*n);let s="";"https:"===location.protocol&&(s="secure"),document.cookie=`${e}=${t};expires=${r.toUTCString()};path=/;sameSite=lax;${s}`}static getItem(e){if(!e)return!1;let t=e+"=",n=document.cookie.split(";");for(let e=0;e<n.length;e++){let r=n[e];for(;" "===r.charAt(0);)r=r.substring(1);if(0===r.indexOf(t))return r.substring(t.length,r.length)}return!1}static removeItem(e){document.cookie=`${e}= ; expires = Thu, 01 Jan 1970 00:00:00 GMT;path=/`}static key(){return""}static clear(){}}class p extends n{constructor(e,t="before"){super(e,t),this._isValidElement()||console.warn(`[ButtonLoadingIndicatorUtil] Parent element is not of type <button> or <a>. Given element: ${this.parent}`)}create(){if(!this._isValidElement()){console.warn(`[ButtonLoadingIndicatorUtil] Unable to create loading indicator. Parent element is not of type <button> or <a>. Given element: ${this.parent}`);return}if("inner"===this.position){let e=this.parent.getBoundingClientRect().width;this.parent.style.width=`${e}px`}super.create(),this.parent.classList.add(`is-loading-indicator-${this.position}`),this._isButtonElement()?this.parent.disabled=!0:this._isAnchorElement()&&this.parent.classList.add("disabled")}remove(){if(!this.exists()){console.warn(`[ButtonLoadingIndicatorUtil] Unable to remove loading indicator. No indicator present on given element: ${this.parent}`);return}"inner"===this.position&&(this.parent.style.width="auto"),super.remove(),this.parent.classList.remove(`is-loading-indicator-${this.position}`),this._isButtonElement()?this.parent.disabled=!1:this._isAnchorElement()&&this.parent.classList.remove("disabled")}_isValidElement(){return this._isButtonElement()||this._isAnchorElement()}_isButtonElement(){return this.parent?.tagName.toLowerCase()==="button"}_isAnchorElement(){return this.parent?.tagName.toLowerCase()==="a"}}class v{static serialize(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if("FORM"!==e.nodeName){if(t)throw Error("The passed element is not a form!");return{}}return new FormData(e)}static serializeJson(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=v.serialize(e,t);if(!(n instanceof FormData)&&0===Object.keys(n).length||n instanceof FormData&&0===Array.from(n.entries()).length)return{};let r={};for(let[e,t]of n.entries())r[e]=t;return r}}class g{constructor(){this._request=null,this._errorHandlingInternal=!1}get(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"application/json",r=this._createPreparedRequest("GET",e,n);return this._sendRequest(r,null,t)}post(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"application/json";r=this._getContentType(t,r);let s=this._createPreparedRequest("POST",e,r);return this._sendRequest(s,t,n)}delete(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"application/json";r=this._getContentType(t,r);let s=this._createPreparedRequest("DELETE",e,r);return this._sendRequest(s,t,n)}patch(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"application/json";r=this._getContentType(t,r);let s=this._createPreparedRequest("PATCH",e,r);return this._sendRequest(s,t,n)}abort(){if(this._request)return this._request.abort()}setErrorHandlingInternal(e){this._errorHandlingInternal=e}_registerOnLoaded(e,t){t&&(!0===this._errorHandlingInternal?(e.addEventListener("load",()=>{t(e.responseText,e)}),e.addEventListener("abort",()=>{console.warn(`the request to ${e.responseURL} was aborted`)}),e.addEventListener("error",()=>{console.warn(`the request to ${e.responseURL} failed with status ${e.status}`)}),e.addEventListener("timeout",()=>{console.warn(`the request to ${e.responseURL} timed out`)})):e.addEventListener("loadend",()=>{t(e.responseText,e)}))}_sendRequest(e,t,n){return this._registerOnLoaded(e,n),e.send(t),e}_getContentType(e,t){return e instanceof FormData&&(t=!1),t}_createPreparedRequest(e,t,n){return this._request=new XMLHttpRequest,this._request.open(e,t),this._request.setRequestHeader("X-Requested-With","XMLHttpRequest"),n&&this._request.setRequestHeader("Content-type",n),this._request}}let{PluginBaseClass:y,PluginManager:f}=window;window.PluginManager.register("NovalnetPayment",class extends y{init(){this._createScript(function(){let e=JSON.parse(this.el.dataset.lineitems),t=new NovalnetPaymentForm,n=document.querySelector("#novalnetId"),r=document.querySelectorAll('#confirmOrderForm button[type="submit"]'),s=document.querySelector('#novalnetchangePaymentForm button[type="submit"]'),i=this,o=document.querySelectorAll('input[name="paymentMethodId"]'),a="novalnetPaymentCookie";if(t.addSkeleton("#novalnetPaymentIframe"),null!=n){(void 0===document.querySelector("input[name=paymentMethodId]:checked")||null===document.querySelector("input[name=paymentMethodId]:checked"))&&(document.querySelector("#paymentMethod"+n.value).checked=!0,i.sendFormPostData());let l=document.querySelector("input[name=paymentMethodId]:checked"),c={iframe:"#novalnetPaymentIframe",initForm:{orderInformation:{lineItems:e},showButton:!1,uncheckPayments:!0}};n.value===l.value&&(c.initForm.uncheckPayments=!1,i.disableSubmitButton(!0)),!1!=h.getItem(a)&&void 0!=h.getItem(a)&&n.value===l.value&&(c.initForm.checkPayment=h.getItem(a)),t.initiate(c),t.validationResponse(e=>{if(t.initiate(c),"340"==e.result.statusCode&&"NO_PAYMENT_METHODS"==e.result.nnpf_subType&&n.value===l.value){i.displayErrorMsg(document.getElementById("iframeErrorMessage").value,"info");return}i.disableSubmitButton(!1)}),o.forEach(function(e){"hidden"!==e.getAttribute("type")&&(e.addEventListener("click",e=>{e.target.value!==n.value&&t.uncheckPayment()}),!0===e.checked&&e.value!==n.value&&t.uncheckPayment())}),t.selectedPayment(function(e){h.setItem(a,e.payment_details.type),"GOOGLEPAY"==e.payment_details.type||"APPLEPAY"==e.payment_details.type?i.hideSubmitButton("none"):i.hideSubmitButton("inline-block"),n.value!==l.value&&(document.querySelector("#paymentMethod"+n.value).checked=!0,null==s&&i.sendFormPostData(!0))}),t.walletResponse({onProcessCompletion:function(e){if("SUCCESS"==e.result.status)return void 0!==document.querySelector("#isSubscriptionRestrict")&&null!==document.querySelector("#isSubscriptionRestrict")&&1==document.querySelector("#isSubscriptionRestrict").value?(window.scrollTo(0,0),{status:"FAILURE",statusText:"failure"}):null!=s?i.subscriptionFetchData(e):(document.querySelector("#novalnet-paymentdata").value=JSON.stringify(e),document.querySelector("#confirmOrderForm").submit(),{status:"SUCCESS",statusText:"successfull"})},onPaymentButtonClicked:function(){return void 0!==document.querySelector("#isSubscriptionRestrict")&&null!==document.querySelector("#isSubscriptionRestrict")&&1==document.querySelector("#isSubscriptionRestrict").value?(window.scrollTo(0,0),"FAILURE"):"SUCCESS"}}),null!=r&&r.forEach(function(e){e.addEventListener("click",e=>{if(n.value===l.value){if(null!==document.querySelector("#tos")&&!0!==document.querySelector("#tos").checked||null!==document.querySelector("#revocation")&&!0!==document.querySelector("#revocation").checked)return!1;i.handleFormSubmit(e,t)}})}),void 0!=s&&null!=s&&s.addEventListener("click",e=>{n.value===l.value&&i.handleFormSubmit(e,t,!0)})}})}handleFormSubmit(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this;this.disableSubmitButton(!0,!0),e.preventDefault(),e.stopImmediatePropagation(),t.getPayment(function(e){"100"===e.result.statusCode||"SUCCESS"===e.result.status?n?r.subscriptionFetchData(e):(document.querySelector("#novalnet-paymentdata").value=JSON.stringify(e),document.querySelector("#confirmOrderForm").submit()):(document.querySelector("#novalnet-paymentdata").value="",r.displayErrorMsg(e.result.message,"danger",n),r.disableSubmitButton(!1,!0))})}subscriptionFetchData(e){new g;let t=document.querySelector("#novalnetId");return void 0!==document.getElementById("parentOrderNumber")&&(e.parentOrderNumber=document.getElementById("parentOrderNumber").value,e.aboId=document.getElementById("aboId").value,e.paymentMethodId=t.value),fetch(document.getElementById("storeCustomerDataUrl").value,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).then(e=>!0==e.success&&void 0!=e.redirect_url?(window.location.replace(e.redirect_url),{status:"SUCCESS",statusText:"successfull"}):!0==e.success?(document.querySelector("#novalnetchangePaymentForm").submit(),{status:"SUCCESS",statusText:"successfull"}):(this.displayErrorMsg(e.message,"danger",!0),{status:"FAILURE",statusText:"failure"}))}disableSubmitButton(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=document.querySelectorAll('#confirmOrderForm button[type="submit"]'),r=document.querySelector('#novalnetchangePaymentForm button[type="submit"]');if(n.length>0)n.forEach(function(n){if(n.disabled=e,t){let t=new p(n);e?t.create():t.remove()}});else if(null!=r&&(r.disabled=e,t)){let t=new p(r);e?t.create():t.remove()}}hideSubmitButton(e){let t=document.querySelectorAll('#confirmOrderForm button[type="submit"]'),n=document.querySelector('#novalnetchangePaymentForm button[type="submit"]');t.length>0?t.forEach(function(t){t.style.display=e}):null!=n&&(n.style.display=e)}sendFormPostData(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=document.querySelector("input[name=paymentMethodId]:checked"),n=v.serialize(t.closest("form")),r=t.closest("form").getAttribute("action");e&&m.create(),fetch(r,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n}).then(e=>e.text()).then(t=>{f.initializePlugins(),e&&(m.remove(),document.querySelector("#novalnetId").closest("form").submit())})}_createScript(e){let t="https://cdn.novalnet.de/js/pv13/checkout.js?"+new Date().getTime(),n=document.createElement("script");n.type="text/javascript",n.src=t,n.addEventListener("load",e.bind(this),!1),document.head.appendChild(n)}displayErrorMsg(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=document.createElement("div"),s=document.createElement("div"),i=document.createElement("div"),o=document.createElement("span");if("danger"==t?r.className="alert alert-danger d-flex align-items-center":r.className="alert alert-info d-flex align-items-center",s.className="alert-content-container",i.className="alert-content",o.className="icon icon-blocked",o.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24" viewBox="0 0 24 24"><defs><path d="M12 24C5.3726 24 0 18.6274 0 12S5.3726 0 12 0s12 5.3726 12 12-5.3726 12-12 12zm0-2c5.5228 0 10-4.4772 10-10S17.5228 2 12 2 2 6.4772 2 12s4.4772 10 10 10zm4.2929-15.7071c.3905-.3905 1.0237-.3905 1.4142 0 .3905.3905.3905 1.0237 0 1.4142l-10 10c-.3905.3905-1.0237.3905-1.4142 0-.3905-.3905-.3905-1.0237 0-1.4142l10-10z" id="icons-default-blocked"></path></defs><use xlink:href="#icons-default-blocked" fill="#758CA3" fill-rule="evenodd"></use></svg>',r.appendChild(o),r.appendChild(s),s.appendChild(i),i.innerHTML=e,n){let e=document.getElementsByClassName("alert alert-danger d-flex align-items-center"),t=document.getElementById("novalnetchangePaymentForm");for(;e.length>0;)e[0].parentNode.removeChild(e[0]);t.parentNode.insertBefore(r,t),r.scrollIntoView()}else document.querySelector(".flashbags").innerHTML="",document.querySelector(".flashbags").appendChild(r),document.querySelector(".flashbags").scrollIntoView()}},"#novalnet-payment-script")})();